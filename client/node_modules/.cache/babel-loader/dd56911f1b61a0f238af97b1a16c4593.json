{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\Users\\\\swizzle1999\\\\Documents\\\\Programming\\\\MERN\\\\cm4025\\\\client\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Users\\\\swizzle1999\\\\Documents\\\\Programming\\\\MERN\\\\cm4025\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"D:\\\\Users\\\\swizzle1999\\\\Documents\\\\Programming\\\\MERN\\\\cm4025\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"D:\\\\Users\\\\swizzle1999\\\\Documents\\\\Programming\\\\MERN\\\\cm4025\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"D:\\\\Users\\\\swizzle1999\\\\Documents\\\\Programming\\\\MERN\\\\cm4025\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"D:\\\\Users\\\\swizzle1999\\\\Documents\\\\Programming\\\\MERN\\\\cm4025\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _inherits from\"D:\\\\Users\\\\swizzle1999\\\\Documents\\\\Programming\\\\MERN\\\\cm4025\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _taggedTemplateLiteral from\"D:\\\\Users\\\\swizzle1999\\\\Documents\\\\Programming\\\\MERN\\\\cm4025\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n    height: auto;\\n    width: 30%;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\nheight: auto;\\nwidth: 15%;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React from'react';import Accordion from\"react-bootstrap/Accordion\";import AccordionToggle from'react-bootstrap/AccordionToggle';import Button from\"react-bootstrap/Button\";import Card from\"react-bootstrap/Card\";import Modal from\"react-bootstrap/Modal\";import Table from'react-bootstrap/Table';import styled from\"styled-components\";import PackListCardComponent from\"./PackListCardComponent\";var fetch=require(\"node-fetch\");var checkForLocalToken=require(\"../utils/checkForLocalToken\");var Logo=styled.img(_templateObject());var Img=styled.img(_templateObject2());//This component is similar to the IventoryListComponent in that it displays one specific pack to the user and then individual cards are displayed via the PackListCardComponent\nvar PackListComponent=/*#__PURE__*/function(_React$Component){_inherits(PackListComponent,_React$Component);function PackListComponent(props){var _this;_classCallCheck(this,PackListComponent);_this=_possibleConstructorReturn(this,_getPrototypeOf(PackListComponent).call(this,props));_this.renderCards=function(){fetch(\"/api/packs/\"+_this.props.code,{method:\"GET\",headers:{\"accepts\":\"application/json\"}}).then(function(res){return res.json();}).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(json){var i;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0://Loop through all the cards and remove that ones that do not include the search filter\nfor(i=0;i<json.cards.length;i++){if(!JSON.stringify(json.cards[i].name).includes(_this.props.filter)){json.cards.splice(i,1);i--;}}_this.setState({cardsComponent:json.cards.map(function(card){return React.createElement(PackListCardComponent,{key:card.id,code:card.id,name:card.name,rarity:card.rarity,filter:_this.props.filter,packCode:_this.props.code});}),informationMessage:\"\"});case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());};_this.fetchHowManyCardsUserOwns=function(){var inventory=null;//Check the user is valid and grab token\ncheckForLocalToken.checkForLocalTokenNoUserObject().then(function(returnObject){if(returnObject!=null){_this.setState({token:returnObject.token});}})//Send token along to verify the user is who they say they are and in order to grab their inventory\n.then(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return fetch(\"/api/auth/user/inventory\",{method:\"GET\",headers:{\"accepts\":\"application/json\",\"x-auth-token\":_this.state.token}}).then(function(res){return res.json();}).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(json){var i;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(json.inventory){//Go over the users inventory and find the correct pack\nfor(i=0;i<json.inventory.length;i++){if(json.inventory[i].code==_this.props.code){//Set the correct pack to the current inventory\ninventory=json.inventory[i].cards;}}if(inventory){_this.setState({ownedCardCount:inventory.length});}else{_this.setState({ownedCardCount:0});}}case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref3.apply(this,arguments);};}());case 2:case\"end\":return _context3.stop();}}},_callee3);})));};_this.openPack=function(event){_this.setState({buttonText:\"Opening Pack...\"});event.preventDefault();checkForLocalToken.checkForLocalTokenNoUserObject().then(function(returnObject){if(returnObject!=null){fetch(\"/api/packs/open/\"+_this.props.code,{method:\"GET\",headers:{\"accepts\":\"application/json\",\"x-auth-token\":returnObject.token}}).then(function(res){return res.json();}).then(function(json){_this.setState({pulledCards:json});_this.showPulledCards();}).then(function(){_this.setState({buttonText:\"Open Pack $\"+_this.state.cost});_this.fetchHowManyCardsUserOwns();var dataToParent={openedPack:true};{_this.props.callbackToParent(dataToParent);}});}});};_this.hidePulledCards=function(){_this.setState({displayPulledCards:false});};_this.showPulledCards=function(){_this.setState({displayPulledCards:true});};_this.processPulledCards=function(){if(_this.state.pulledCards.error){return React.createElement(\"div\",{style:{textAlign:\"center\"}},React.createElement(\"h1\",null,_this.state.pulledCards.error));}else{if(_this.state.pulledCards[0]&&_this.state.pulledCards[1]&&_this.state.pulledCards[2]){return React.createElement(\"div\",{style:{textAlign:\"center\"}},React.createElement(Img,{src:\"https://cm4025.s3.eu-west-2.amazonaws.com/packs/\"+_this.state.pulledCards[0].setCode+\"/\"+_this.state.pulledCards[0].id+\".jpg\"}),React.createElement(Img,{src:\"https://cm4025.s3.eu-west-2.amazonaws.com/packs/\"+_this.state.pulledCards[1].setCode+\"/\"+_this.state.pulledCards[1].id+\".jpg\"}),React.createElement(Img,{src:\"https://cm4025.s3.eu-west-2.amazonaws.com/packs/\"+_this.state.pulledCards[2].setCode+\"/\"+_this.state.pulledCards[2].id+\".jpg\"}));}else{return;}}};_this.state={cost:0,displayPulledCards:false,pulledCards:{},cardsComponent:null,informationMessage:\"Loading...\",filter:\"\",buttonText:\"\",ownedCardCount:0,totalCardCount:0,token:null,forceUpdate:0};return _this;}//Set pack cost if the cost props is null for any reason\n_createClass(PackListComponent,[{key:\"componentDidMount\",value:function componentDidMount(){if(this.props.cost==null){this.setState({cost:10});this.setState({buttonText:\"Open Pack $\"+\"10\"});}else{this.setState({cost:this.props.cost});this.setState({buttonText:\"Open Pack $\"+this.props.cost});}this.fetchHowManyCardsUserOwns();}//When component updates it checks to see if the search filter has changed\n//If it has it knows it must re render the cards\n//\"prevState.cardsComponent != null\" works because even though if we type something in that gets no result. its not null, its an empty array\n},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState){if(prevProps.filter!=this.props.filter&&prevState.cardsComponent!=null){this.setState({informationMessage:\"Loading...\"});this.renderCards();}}//Function that is called when the props of this component change, performs a state change to update the filter\n//Cards component is set to null to get rid of all existing cards from the list\n},{key:\"render\",value:function render(){return React.createElement(\"div\",null,React.createElement(Modal,{show:this.state.displayPulledCards,onHide:this.hidePulledCards,size:\"lg\",\"aria-labelledby\":\"contained-modal-title-vcenter\",centered:true},React.createElement(Modal.Header,null,React.createElement(Modal.Title,{id:\"contained-modal-title-vcenter\"},\"Cards\")),React.createElement(Modal.Body,null,this.processPulledCards()),React.createElement(Modal.Footer,null,React.createElement(Button,{onClick:this.hidePulledCards},\"Close\"))),React.createElement(Card,null,React.createElement(Card.Header,null,React.createElement(AccordionToggle,{as:Button,onClick:this.renderCards,variant:\"link\",eventKey:this.props.code+\"Server\"},this.props.name,React.createElement(Logo,{style:{marginLeft:\"0.5rem\",marginRight:\"0.5rem\"},src:\"https://cm4025.s3.amazonaws.com/packs/\"+this.props.code+\"/\"+this.props.code+\"Logo.jpg\"}),React.createElement(\"br\",null),\"Level Requirment: \",this.props.level),React.createElement(\"br\",null),React.createElement(Button,{variant:\"success\",onClick:this.openPack},this.state.buttonText),React.createElement(\"br\",null),React.createElement(\"br\",null),React.createElement(\"p\",null,\"You Own: \",this.state.ownedCardCount,\"/\",this.props.totalCards,\" Cards In This Set\")),React.createElement(Accordion.Collapse,{eventKey:this.props.code+\"Server\"},React.createElement(Card.Body,null,React.createElement(Table,{striped:true,bordered:true,hover:true},React.createElement(\"thead\",null,React.createElement(\"tr\",null,React.createElement(\"th\",null,\"Card Code\"),React.createElement(\"th\",null,\"Name\"),React.createElement(\"th\",null,\"Rarity\"),React.createElement(\"th\",null,\"Image\"))),React.createElement(\"tbody\",null,this.state.cardsComponent)),React.createElement(\"h1\",null,this.state.informationMessage)))));}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(nextProps,prevState){if(nextProps.filter!=prevState.filter){return{filter:nextProps.filter,cardsComponent:null};}}//Performs a fetch request to the API in order to get data about a specific pack and then filters all of the cards in that pack against the filter the user specified at the top of the screen\n//The cards are then mapped to the PackListCardComponent and stored in the cardsComponent state in order to be displayed\n}]);return PackListComponent;}(React.Component);export{PackListComponent as default};","map":{"version":3,"sources":["D:/Users/swizzle1999/Documents/Programming/MERN/cm4025/client/src/components/PackListComponent.js"],"names":["React","Accordion","AccordionToggle","Button","Card","Modal","Table","styled","PackListCardComponent","fetch","require","checkForLocalToken","Logo","img","Img","PackListComponent","props","renderCards","code","method","headers","then","res","json","i","cards","length","JSON","stringify","name","includes","filter","splice","setState","cardsComponent","map","card","id","rarity","informationMessage","fetchHowManyCardsUserOwns","inventory","checkForLocalTokenNoUserObject","returnObject","token","state","ownedCardCount","openPack","event","buttonText","preventDefault","pulledCards","showPulledCards","cost","dataToParent","openedPack","callbackToParent","hidePulledCards","displayPulledCards","processPulledCards","error","textAlign","setCode","totalCardCount","forceUpdate","prevProps","prevState","marginLeft","marginRight","level","totalCards","nextProps","Component"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport Accordion from \"react-bootstrap/Accordion\";\r\nimport AccordionToggle from 'react-bootstrap/AccordionToggle';\r\nimport Button from \"react-bootstrap/Button\";\r\nimport Card from \"react-bootstrap/Card\";\r\nimport Modal from \"react-bootstrap/Modal\";\r\nimport Table from 'react-bootstrap/Table';\r\nimport styled from \"styled-components\";\r\nimport PackListCardComponent from \"./PackListCardComponent\";\r\n\r\nconst fetch = require(\"node-fetch\");\r\nconst checkForLocalToken = require(\"../utils/checkForLocalToken\");\r\n\r\nconst Logo = styled.img`\r\nheight: auto;\r\nwidth: 15%;\r\n`\r\n\r\nconst Img = styled.img`\r\n    height: auto;\r\n    width: 30%;\r\n`\r\n\r\n//This component is similar to the IventoryListComponent in that it displays one specific pack to the user and then individual cards are displayed via the PackListCardComponent\r\nexport default class PackListComponent extends React.Component{\r\n    constructor(props){\r\n        super(props);\r\n\r\n        this.state = {\r\n            cost: 0,\r\n            displayPulledCards: false,\r\n            pulledCards: {},\r\n            cardsComponent: null,\r\n            informationMessage: \"Loading...\",\r\n            filter: \"\",\r\n            buttonText: \"\",\r\n            ownedCardCount: 0,\r\n            totalCardCount: 0,\r\n            token: null,\r\n            forceUpdate: 0\r\n          }\r\n    }\r\n\r\n    //Set pack cost if the cost props is null for any reason\r\n    componentDidMount(){\r\n        if (this.props.cost == null){\r\n            this.setState({cost: 10});   \r\n            \r\n            this.setState({\r\n                buttonText: \"Open Pack $\" + \"10\"\r\n            })\r\n        } else {\r\n            this.setState({cost: this.props.cost})\r\n\r\n            this.setState({\r\n                buttonText: \"Open Pack $\" + this.props.cost\r\n            })\r\n        }\r\n\r\n        this.fetchHowManyCardsUserOwns();\r\n    }\r\n\r\n    //When component updates it checks to see if the search filter has changed\r\n    //If it has it knows it must re render the cards\r\n    //\"prevState.cardsComponent != null\" works because even though if we type something in that gets no result. its not null, its an empty array\r\n    componentDidUpdate(prevProps, prevState){\r\n        if (prevProps.filter != this.props.filter && prevState.cardsComponent != null){\r\n            this.setState({informationMessage: \"Loading...\"})\r\n            this.renderCards()\r\n        }\r\n    }\r\n\r\n    //Function that is called when the props of this component change, performs a state change to update the filter\r\n    //Cards component is set to null to get rid of all existing cards from the list\r\n    static getDerivedStateFromProps(nextProps, prevState){\r\n        if (nextProps.filter != prevState.filter){\r\n            return ({filter: nextProps.filter, cardsComponent: null})\r\n        }\r\n    }\r\n\r\n    //Performs a fetch request to the API in order to get data about a specific pack and then filters all of the cards in that pack against the filter the user specified at the top of the screen\r\n    //The cards are then mapped to the PackListCardComponent and stored in the cardsComponent state in order to be displayed\r\n    renderCards = () => {\r\n        fetch(\"/api/packs/\" + this.props.code, {method: \"GET\", headers:{\"accepts\": \"application/json\"}})\r\n        .then(res => res.json())\r\n        .then(async json => {\r\n            //Loop through all the cards and remove that ones that do not include the search filter\r\n            for (let i = 0; i < json.cards.length; i++){\r\n                if (!JSON.stringify(json.cards[i].name).includes(this.props.filter)){\r\n                    json.cards.splice(i, 1)\r\n                    i--\r\n                }\r\n            }\r\n            this.setState({\r\n                cardsComponent: json.cards.map(card => <PackListCardComponent key={card.id} code={card.id} name={card.name} rarity={card.rarity} filter={this.props.filter} packCode={this.props.code}/>),\r\n                informationMessage: \"\",\r\n            })\r\n        })\r\n    }\r\n\r\n    //Simple function that calls to the API in order to determine how many cards the user owns out of a specific pack\r\n    fetchHowManyCardsUserOwns = () => {\r\n        let inventory = null\r\n        //Check the user is valid and grab token\r\n        checkForLocalToken.checkForLocalTokenNoUserObject()\r\n        .then(returnObject => {\r\n          if (returnObject != null){\r\n            this.setState({\r\n              token: returnObject.token,\r\n          })\r\n          }\r\n        })\r\n        //Send token along to verify the user is who they say they are and in order to grab their inventory\r\n        .then(async () => {\r\n            await fetch(\"/api/auth/user/inventory\", {method: \"GET\", headers:{\"accepts\": \"application/json\", \"x-auth-token\": this.state.token}})\r\n            .then(res => res.json())\r\n            .then(async json => {\r\n                if (json.inventory){\r\n                    //Go over the users inventory and find the correct pack\r\n                    for (let i = 0; i < json.inventory.length; i++){\r\n                        if (json.inventory[i].code == this.props.code){\r\n                            //Set the correct pack to the current inventory\r\n                            inventory = json.inventory[i].cards;\r\n                        }\r\n                    }\r\n\r\n                    if (inventory){\r\n                        this.setState({ownedCardCount: inventory.length})\r\n                    } else {\r\n                        this.setState({ownedCardCount: 0})\r\n                    }\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    //Function deals with actually opening this specific pack.\r\n    //API call is sent the users token and then returns the 3 cards the user recieved if they met the requirments to open the pack \r\n    openPack = (event) => {\r\n        this.setState({\r\n            buttonText: \"Opening Pack...\",\r\n        })\r\n\r\n        event.preventDefault();\r\n        checkForLocalToken.checkForLocalTokenNoUserObject()\r\n        .then(returnObject => {\r\n            if (returnObject != null){\r\n                fetch(\"/api/packs/open/\"+this.props.code, {method: \"GET\", headers:{\"accepts\": \"application/json\", \"x-auth-token\": returnObject.token}})\r\n                .then(res => res.json())\r\n                .then(json => {\r\n                    this.setState({\r\n                        pulledCards: json,\r\n                    })\r\n                    this.showPulledCards();\r\n                })\r\n                .then(() => {\r\n                    this.setState({\r\n                        buttonText: \"Open Pack $\" + this.state.cost,\r\n                    })\r\n\r\n                    this.fetchHowManyCardsUserOwns();\r\n                    let dataToParent ={\r\n                        openedPack: true,\r\n                    }\r\n                    {this.props.callbackToParent(dataToParent)}\r\n                })\r\n                \r\n            }\r\n        })\r\n    }\r\n\r\n    //Simple hide and show functions to hide and show the opened cards from this pack\r\n    hidePulledCards = () =>{\r\n        this.setState({displayPulledCards: false});\r\n    }\r\n\r\n    showPulledCards = () =>{\r\n        this.setState({displayPulledCards: true});\r\n    }\r\n\r\n    //Itterates over the cards the user just recieved and displays the cards image\r\n    processPulledCards = () => {\r\n        if (this.state.pulledCards.error){\r\n            return (\r\n                <div style={{textAlign: \"center\"}}>\r\n                    <h1>{this.state.pulledCards.error}</h1>\r\n                </div>\r\n            );\r\n        } else {\r\n            if (this.state.pulledCards[0] && this.state.pulledCards[1] && this.state.pulledCards[2]){\r\n                return (\r\n                    <div style={{textAlign: \"center\"}}>\r\n                        <Img src={\"https://cm4025.s3.eu-west-2.amazonaws.com/packs/\" + this.state.pulledCards[0].setCode + \"/\" + this.state.pulledCards[0].id + \".jpg\"}></Img>\r\n                        <Img src={\"https://cm4025.s3.eu-west-2.amazonaws.com/packs/\" + this.state.pulledCards[1].setCode + \"/\" + this.state.pulledCards[1].id + \".jpg\"}></Img>\r\n                        <Img src={\"https://cm4025.s3.eu-west-2.amazonaws.com/packs/\" + this.state.pulledCards[2].setCode + \"/\" + this.state.pulledCards[2].id + \".jpg\"}></Img>\r\n                    </div>\r\n                );\r\n            } else {\r\n                return;\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <Modal show={this.state.displayPulledCards} onHide={this.hidePulledCards} size=\"lg\" aria-labelledby=\"contained-modal-title-vcenter\" centered>\r\n                    <Modal.Header>\r\n                        <Modal.Title id=\"contained-modal-title-vcenter\">\r\n                            Cards\r\n                        </Modal.Title>\r\n                    </Modal.Header>\r\n                    <Modal.Body>\r\n                        {this.processPulledCards()}\r\n                    </Modal.Body>\r\n                    <Modal.Footer>\r\n                        <Button onClick={this.hidePulledCards}>Close</Button>\r\n                    </Modal.Footer>\r\n                </Modal>\r\n                <Card>\r\n                    <Card.Header>\r\n                        <AccordionToggle as={Button} onClick={this.renderCards} variant=\"link\" eventKey={this.props.code+\"Server\"}>\r\n                            {this.props.name}  \r\n                            <Logo style={{marginLeft: \"0.5rem\", marginRight: \"0.5rem\"}}src={\"https://cm4025.s3.amazonaws.com/packs/\" + this.props.code + \"/\" + this.props.code + \"Logo.jpg\"}/>\r\n                            <br></br>\r\n                            Level Requirment: {this.props.level}\r\n                        </AccordionToggle>\r\n                        <br></br>\r\n                        <Button variant=\"success\" onClick={this.openPack}>{this.state.buttonText}</Button>\r\n                        <br></br>\r\n                        <br></br>\r\n                        <p>You Own: {this.state.ownedCardCount}/{this.props.totalCards} Cards In This Set</p>\r\n                    </Card.Header>\r\n                    <Accordion.Collapse eventKey={this.props.code+\"Server\"}>\r\n                        <Card.Body>\r\n                            <Table striped bordered hover>\r\n                                <thead>\r\n                                    <tr>\r\n                                        <th>Card Code</th>\r\n                                        <th>Name</th>\r\n                                        <th>Rarity</th>\r\n                                        <th>Image</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    {this.state.cardsComponent} \r\n                                </tbody>\r\n                            </Table>\r\n                            <h1>{this.state.informationMessage}</h1>\r\n                        </Card.Body>\r\n                    </Accordion.Collapse>\r\n                </Card>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}